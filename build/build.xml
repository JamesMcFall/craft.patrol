<?xml version="1.0" encoding="UTF-8"?>

<project name="Patrol" default="build">

    <property name="jsPath" value="../resources/js/" />
    <property name="cssPath" value="../resources/css/" />
    <property name="minPath" value="../resources/min/" />
    <property name="pluginVersion" value="v0.9.1" />

    <target name="clean">
        <echo msg="Running cleaning task..." />
        <delete file="${minPath}patrol.js" verbose="false" failonerror="false" />
        <delete file="${minPath}patrol.css" verbose="false" failonerror="false" />
    </target>

    <target name="concatenate" depends="clean">
        <echo msg="Combining JS and CSS..." />
        <append destfile="${minPath}patrol.js">
            <filelist dir="${jsPath}" listfile="js.txt" />
        </append>
        <append destfile="${minPath}patrol.css">
            <filelist dir="${cssPath}" listfile="css.txt" />
        </append>
    </target>

    <target name="minify" depends="concatenate">
        <echo msg="Minifying combined sources..." />
        <exec command="java -jar YUI2.4.8.jar ${minPath}patrol.js -o ${minPath}patrol.js" />
        <exec command="java -jar YUI2.4.8.jar ${minPath}patrol.css -o ${minPath}patrol.css" />
    </target>

    <target name="build" depends="minify">
        <echo msg="Finishing up..." />
    </target>

    <target name="release">
        <echo msg="Preparing release distro..." />
        <zip destfile="../../patrol.${pluginVersion}.zip">
            <fileset dir="../../">
                <include name="patrol/" />
                <exclude name="patrol/build/" />
                <exclude name="patrol/.git/" />
                <exclude name="patrol/.idea/" />
                <exclude name="patrol/.gitignore" />
            </fileset>
        </zip>
        <echo msg="Release .zip has been created!" />
    </target>

</project>
